---
layout: blog
title: ddの出力をssh経由で転送する方法
tag: linux ssh
---

# ddの出力をssh経由で転送する方法

`dd`でバックアップを取得する時に、ローカルにファイルを作らずに、リモートホストに結果を直接転送したい場合がある。そのような場合は、以下のようにsshを組み合わせれば、ddの出力をリモートホストに送ることができる。

    dd if=/dev/sda | ssh remotehost dd of =/tmp/image

`/dev/sda`は出力したいブロックデバイスに、`remotehost`は転送先のリモートホストに、`/tmp/image`はリモートホストの保存先のパスにそれぞれ読み替える。

このコマンドの仕組みは以下のようなものだ。

1. `dd`は`of=`を省略すると、標準出力に結果を出力する。
2. それを`ssh`にパイプで渡す。
3. `ssh`は`ssh remotehost command`の形で実行すると、リモートホストでコマンドを実行する。この時`ssh`は`ssh`への標準入力を実行するコマンドの標準入力に接続する。
4. `dd`は`of=`の場合と同様に`if=`を省略すると標準入力を入力として動作する。

これで結果としてローカルホストの`dd`の出力がリモートホストの`dd`の入力となるのだ。
