---
layout: blog
title: Rubyの||=というイディオムは左辺が未定義または偽なら代入の意味
tag: ruby
---

# Rubyの||=というイディオムは左辺が未定義または偽なら代入の意味

Rubyスクリプトで目にする以下のイディオムは、左辺が未定義または偽なら右辺の値を代入するという意味だ。このイディオムは変数の初期化で良く用いられる。

~~~~
a ||= true
~~~~

このイディオムを自己代入演算子を省略せず書くと以下と同じ意味である。

~~~~
a || (a = true)
~~~~

通常、`a op= b`(`op`は`+`などの演算子)のような自己代入演算子は`a = a op b`と同義だが、`||`と`&&`だけは例外で、`a op (a = b)`の扱いとなる。
よって、このイディオムは以下とは意味が異なることには注意が必要だ。

~~~~
a = a || b
~~~~

`||`と`or`は同じであり、`or`のリファレンスを読むと次の説明がある。

> まず左辺を評価して、結果が偽であった場合には右辺も評価します。 or は同じ働きをする優先順位の低い演算子です。

これで`||=`のイディオムの意味は完全に理解できる。
はじめから繰り返すと、

~~~~
a ||= true
~~~~

は

~~~~
a || (a = true)
~~~~

であり、`||`は、左辺をまず評価して、結果が真なら何もせず、偽なら右辺の変数`a`への代入を評価する。よって、このイディオムは`a`が未定義または偽なら右辺の値を代入する、という意味になるのだ。

- [演算子式](http://docs.ruby-lang.org/ja/1.8.7/doc/spec=2foperator.html)
- [What does \|\|= (or equals) mean in Ruby?](http://stackoverflow.com/questions/995593/what-does-or-equals-mean-in-ruby)
